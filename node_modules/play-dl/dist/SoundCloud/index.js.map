{"version":3,"file":"index.js","sourceRoot":"","sources":["../../play-dl/SoundCloud/index.ts"],"names":[],"mappings":"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","sourcesContent":["import fs from 'node:fs';\nimport { StreamType } from '../YouTube/stream';\nimport { request } from '../Request';\nimport { SoundCloudPlaylist, SoundCloudTrack, SoundCloudTrackFormat, Stream } from './classes';\n\nlet soundData: SoundDataOptions;\nif (fs.existsSync('.data/soundcloud.data')) {\n    soundData = JSON.parse(fs.readFileSync('.data/soundcloud.data').toString());\n}\n\ninterface SoundDataOptions {\n    client_id: string;\n}\n\nconst pattern = /^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?(api\\.soundcloud\\.com|soundcloud\\.com|snd\\.sc)\\/(.*)$/;\n/**\n * Function to get info from a soundcloud url\n * @param url soundcloud url\n * @returns SoundCloud Track or SoundCloud Playlist\n */\nexport async function soundcloud(url: string): Promise<SoundCloud> {\n    if (!soundData) throw new Error('SoundCloud Data is missing\\nDid you forgot to do authorization ?');\n    if (!url.match(pattern)) throw new Error('This is not a SoundCloud URL');\n\n    const data = await request(\n        `https://api-v2.soundcloud.com/resolve?url=${url}&client_id=${soundData.client_id}`\n    ).catch((err: Error) => err);\n\n    if (data instanceof Error) throw data;\n\n    const json_data = JSON.parse(data);\n\n    if (json_data.kind !== 'track' && json_data.kind !== 'playlist')\n        throw new Error('This url is out of scope for play-dl.');\n\n    if (json_data.kind === 'track') return new SoundCloudTrack(json_data);\n    else return new SoundCloudPlaylist(json_data, soundData.client_id);\n}\n/**\n * Type of SoundCloud\n */\nexport type SoundCloud = SoundCloudTrack | SoundCloudPlaylist;\n/**\n * Function for searching in SoundCloud\n * @param query query to search\n * @param type 'tracks' | 'playlists' | 'albums'\n * @param limit max no. of results\n * @returns Array of SoundCloud type.\n */\nexport async function so_search(\n    query: string,\n    type: 'tracks' | 'playlists' | 'albums',\n    limit: number = 10\n): Promise<SoundCloud[]> {\n    const response = await request(\n        `https://api-v2.soundcloud.com/search/${type}?q=${query}&client_id=${soundData.client_id}&limit=${limit}`\n    );\n    const results: (SoundCloudPlaylist | SoundCloudTrack)[] = [];\n    const json_data = JSON.parse(response);\n    json_data.collection.forEach((x: any) => {\n        if (type === 'tracks') results.push(new SoundCloudTrack(x));\n        else results.push(new SoundCloudPlaylist(x, soundData.client_id));\n    });\n    return results;\n}\n/**\n * Main Function for creating a Stream of soundcloud\n * @param url soundcloud url\n * @param quality Quality to select from\n * @returns SoundCloud Stream\n */\nexport async function stream(url: string, quality?: number): Promise<Stream> {\n    const data = await soundcloud(url);\n\n    if (data instanceof SoundCloudPlaylist) throw new Error(\"Streams can't be created from Playlist url\");\n\n    const HLSformats = parseHlsFormats(data.formats);\n    if (typeof quality !== 'number') quality = HLSformats.length - 1;\n    else if (quality <= 0) quality = 0;\n    else if (quality >= HLSformats.length) quality = HLSformats.length - 1;\n    const req_url = HLSformats[quality].url + '?client_id=' + soundData.client_id;\n    const s_data = JSON.parse(await request(req_url));\n    const type = HLSformats[quality].format.mime_type.startsWith('audio/ogg')\n        ? StreamType.OggOpus\n        : StreamType.Arbitrary;\n    return new Stream(s_data.url, type);\n}\n/**\n * Function to get Free Client ID of soundcloud.\n * @returns client ID\n */\nexport async function getFreeClientID(): Promise<string> {\n    const data = await request('https://soundcloud.com/');\n    const splitted = data.split('<script crossorigin src=\"');\n    const urls: string[] = [];\n    splitted.forEach((r) => {\n        if (r.startsWith('https')) {\n            urls.push(r.split('\"')[0]);\n        }\n    });\n    const data2 = await request(urls[urls.length - 1]);\n    return data2.split(',client_id:\"')[1].split('\"')[0];\n}\n\n/**\n * Type for SoundCloud Stream\n */\nexport type SoundCloudStream = Stream;\n/**\n * Function for creating a Stream of soundcloud using a SoundCloud Track Class\n * @param data SoundCloud Track Class\n * @param quality Quality to select from\n * @returns SoundCloud Stream\n */\nexport async function stream_from_info(data: SoundCloudTrack, quality?: number): Promise<SoundCloudStream> {\n    const HLSformats = parseHlsFormats(data.formats);\n    if (typeof quality !== 'number') quality = HLSformats.length - 1;\n    else if (quality <= 0) quality = 0;\n    else if (quality >= HLSformats.length) quality = HLSformats.length - 1;\n    const req_url = HLSformats[quality].url + '?client_id=' + soundData.client_id;\n    const s_data = JSON.parse(await request(req_url));\n    const type = HLSformats[quality].format.mime_type.startsWith('audio/ogg')\n        ? StreamType.OggOpus\n        : StreamType.Arbitrary;\n    return new Stream(s_data.url, type);\n}\n/**\n * Function to check client ID\n * @param id Client ID\n * @returns boolean\n */\nexport async function check_id(id: string): Promise<boolean> {\n    const response = await request(`https://api-v2.soundcloud.com/search?client_id=${id}&q=Rick+Roll&limit=0`).catch(\n        (err: Error) => {\n            return err;\n        }\n    );\n    if (response instanceof Error) return false;\n    else return true;\n}\n/**\n * Function to validate for a soundcloud url\n * @param url soundcloud url\n * @returns \"false\" | 'track' | 'playlist'\n */\nexport async function so_validate(url: string): Promise<false | 'track' | 'playlist' | 'search'> {\n    if (!url.match(pattern)) return 'search';\n    const data = await request(\n        `https://api-v2.soundcloud.com/resolve?url=${url}&client_id=${soundData.client_id}`\n    ).catch((err: Error) => err);\n\n    if (data instanceof Error) return false;\n\n    const json_data = JSON.parse(data);\n    if (json_data.kind === 'track') return 'track';\n    else if (json_data.kind === 'playlist') return 'playlist';\n    else return false;\n}\n/**\n * Function to select only hls streams from SoundCloud format array\n * @param data SoundCloud Track Format data\n * @returns a new array containing hls formats\n */\nfunction parseHlsFormats(data: SoundCloudTrackFormat[]) {\n    const result: SoundCloudTrackFormat[] = [];\n    data.forEach((format) => {\n        if (format.format.protocol === 'hls') result.push(format);\n    });\n    return result;\n}\n\nexport function setSoundCloudToken(options: SoundDataOptions) {\n    soundData = options;\n}\n"]}