{"version":3,"file":"index.js","sourceRoot":"","sources":["../../play-dl/Spotify/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { request } from '../Request';\nimport { SpotifyAlbum, SpotifyPlaylist, SpotifyTrack } from './classes';\nimport fs from 'node:fs';\n\nlet spotifyData: SpotifyDataOptions;\nif (fs.existsSync('.data/spotify.data')) {\n    spotifyData = JSON.parse(fs.readFileSync('.data/spotify.data').toString());\n    spotifyData.file = true;\n}\n/**\n * Spotify Data options that are stored in spotify.data file.\n */\nexport interface SpotifyDataOptions {\n    client_id: string;\n    client_secret: string;\n    redirect_url?: string;\n    authorization_code?: string;\n    access_token?: string;\n    refresh_token?: string;\n    token_type?: string;\n    expires_in?: number;\n    expiry?: number;\n    market?: string;\n    file?: boolean;\n}\n\nconst pattern = /^((https:)?\\/\\/)?open.spotify.com\\/(track|album|playlist)\\//;\n/**\n * Function to get Playlist | Album | Track\n * @param url url of spotify from which you want info\n * @returns Spotify type.\n */\nexport async function spotify(url: string): Promise<Spotify> {\n    if (!spotifyData) throw new Error('Spotify Data is missing\\nDid you forgot to do authorization ?');\n    if (!url.match(pattern)) throw new Error('This is not a Spotify URL');\n    if (url.indexOf('track/') !== -1) {\n        const trackID = url.split('track/')[1].split('&')[0].split('?')[0];\n        const response = await request(`https://api.spotify.com/v1/tracks/${trackID}?market=${spotifyData.market}`, {\n            headers: {\n                Authorization: `${spotifyData.token_type} ${spotifyData.access_token}`\n            }\n        }).catch((err: Error) => {\n            return err;\n        });\n        if (response instanceof Error) throw response;\n        return new SpotifyTrack(JSON.parse(response));\n    } else if (url.indexOf('album/') !== -1) {\n        const albumID = url.split('album/')[1].split('&')[0].split('?')[0];\n        const response = await request(`https://api.spotify.com/v1/albums/${albumID}?market=${spotifyData.market}`, {\n            headers: {\n                Authorization: `${spotifyData.token_type} ${spotifyData.access_token}`\n            }\n        }).catch((err: Error) => {\n            return err;\n        });\n        if (response instanceof Error) throw response;\n        return new SpotifyAlbum(JSON.parse(response), spotifyData);\n    } else if (url.indexOf('playlist/') !== -1) {\n        const playlistID = url.split('playlist/')[1].split('&')[0].split('?')[0];\n        const response = await request(\n            `https://api.spotify.com/v1/playlists/${playlistID}?market=${spotifyData.market}`,\n            {\n                headers: {\n                    Authorization: `${spotifyData.token_type} ${spotifyData.access_token}`\n                }\n            }\n        ).catch((err: Error) => {\n            return err;\n        });\n        if (response instanceof Error) throw response;\n        return new SpotifyPlaylist(JSON.parse(response), spotifyData);\n    } else throw new Error('URL is out of scope for play-dl.');\n}\n/**\n * Function to validate Spotify url\n * @param url url for validation\n * @returns type of url or false.\n */\nexport function sp_validate(url: string): 'track' | 'playlist' | 'album' | 'search' | false {\n    if (!url.match(pattern)) return 'search';\n    if (url.indexOf('track/') !== -1) {\n        return 'track';\n    } else if (url.indexOf('album/') !== -1) {\n        return 'album';\n    } else if (url.indexOf('playlist/') !== -1) {\n        return 'playlist';\n    } else return false;\n}\n/**\n * Fuction for authorizing for spotify data.\n * @param data Sportify Data options to validate\n * @returns boolean.\n */\nexport async function SpotifyAuthorize(data: SpotifyDataOptions, file: boolean): Promise<boolean> {\n    const response = await request(`https://accounts.spotify.com/api/token`, {\n        headers: {\n            'Authorization': `Basic ${Buffer.from(`${data.client_id}:${data.client_secret}`).toString('base64')}`,\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: `grant_type=authorization_code&code=${data.authorization_code}&redirect_uri=${encodeURI(\n            data.redirect_url as string\n        )}`,\n        method: 'POST'\n    }).catch((err: Error) => {\n        return err;\n    });\n    if (response instanceof Error) throw response;\n    const resp_json = JSON.parse(response);\n    spotifyData = {\n        client_id: data.client_id,\n        client_secret: data.client_secret,\n        redirect_url: data.redirect_url,\n        access_token: resp_json.access_token,\n        refresh_token: resp_json.refresh_token,\n        expires_in: Number(resp_json.expires_in),\n        expiry: Date.now() + (resp_json.expires_in - 1) * 1000,\n        token_type: resp_json.token_type,\n        market: data.market\n    };\n    if (file) fs.writeFileSync('.data/spotify.data', JSON.stringify(spotifyData, undefined, 4));\n    else {\n        console.log(`Client ID : ${spotifyData.client_id}`);\n        console.log(`Client Secret : ${spotifyData.client_secret}`);\n        console.log(`Refresh Token : ${spotifyData.refresh_token}`);\n        console.log(`Market : ${spotifyData.market}`);\n        console.log(`\\nPaste above info in setToken function.`);\n    }\n    return true;\n}\n/**\n * Function to check if authorization token is expired or not.\n * @returns boolean\n */\nexport function is_expired(): boolean {\n    if (Date.now() >= (spotifyData.expiry as number)) return true;\n    else return false;\n}\n/**\n * type for Spotify Class\n */\nexport type Spotify = SpotifyAlbum | SpotifyPlaylist | SpotifyTrack;\n/**\n * Function for searching songs on Spotify\n * @param query searching query\n * @param type \"album\" | \"playlist\" | \"track\"\n * @param limit max no of results\n * @returns Spotify type.\n */\nexport async function sp_search(\n    query: string,\n    type: 'album' | 'playlist' | 'track',\n    limit: number = 10\n): Promise<Spotify[]> {\n    const results: Spotify[] = [];\n    if (!spotifyData) throw new Error('Spotify Data is missing\\nDid you forgot to do authorization ?');\n    if (query.length === 0) throw new Error('Pass some query to search.');\n    if (limit > 50 || limit < 0) throw new Error(`You crossed limit range of Spotify [ 0 - 50 ]`);\n    const response = await request(\n        `https://api.spotify.com/v1/search?type=${type}&q=${query}&limit=${limit}&market=${spotifyData.market}`,\n        {\n            headers: {\n                Authorization: `${spotifyData.token_type} ${spotifyData.access_token}`\n            }\n        }\n    ).catch((err: Error) => {\n        return err;\n    });\n    if (response instanceof Error) throw response;\n    const json_data = JSON.parse(response);\n    if (type === 'track') {\n        json_data.tracks.items.forEach((track: any) => {\n            results.push(new SpotifyTrack(track));\n        });\n    } else if (type === 'album') {\n        json_data.albums.items.forEach((album: any) => {\n            results.push(new SpotifyAlbum(album, spotifyData));\n        });\n    } else if (type === 'playlist') {\n        json_data.playlists.items.forEach((playlist: any) => {\n            results.push(new SpotifyPlaylist(playlist, spotifyData));\n        });\n    }\n    return results;\n}\n/**\n * Function to refresh Token\n * @returns boolean to check whether token is refreshed or not\n */\nexport async function refreshToken(): Promise<boolean> {\n    const response = await request(`https://accounts.spotify.com/api/token`, {\n        headers: {\n            'Authorization': `Basic ${Buffer.from(`${spotifyData.client_id}:${spotifyData.client_secret}`).toString(\n                'base64'\n            )}`,\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: `grant_type=refresh_token&refresh_token=${spotifyData.refresh_token}`,\n        method: 'POST'\n    }).catch((err: Error) => {\n        return err;\n    });\n    if (response instanceof Error) return false;\n    const resp_json = JSON.parse(response);\n    spotifyData.access_token = resp_json.access_token;\n    spotifyData.expires_in = Number(resp_json.expires_in);\n    spotifyData.expiry = Date.now() + (resp_json.expires_in - 1) * 1000;\n    spotifyData.token_type = resp_json.token_type;\n    if (spotifyData.file) fs.writeFileSync('.data/spotify.data', JSON.stringify(spotifyData, undefined, 4));\n    return true;\n}\n\nexport function setSpotifyToken(options: SpotifyDataOptions) {\n    spotifyData = options;\n    spotifyData.file = false;\n    refreshToken();\n}\n"]}